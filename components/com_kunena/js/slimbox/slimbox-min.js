var Slimbox=(function(){var U=window,am=Browser.Engine.trident4,af,au,T=-1,al,ad,V,ae,ab,N,ah,an={},ag=new Image(),P=new Image(),R,aA,at,aj,Q,aw,S,ay,Z,O,ac,ar,ax,X;U.addEvent("domready",function(){$(document.body).adopt($$(R=new Element("div",{id:"lbOverlay",events:{click:W}}),aA=new Element("div",{id:"lbCenter"}),S=new Element("div",{id:"lbBottomContainer"})).setStyle("display","none"));at=new Element("div",{id:"lbImage"}).injectInside(aA).adopt(aj=new Element("div",{styles:{position:"relative"}}).adopt(Q=new Element("a",{id:"lbPrevLink",href:"#",events:{click:Y}}),aw=new Element("a",{id:"lbNextLink",href:"#",events:{click:av}})));ay=new Element("div",{id:"lbBottom"}).injectInside(S).adopt(new Element("a",{id:"lbCloseLink",href:"#",events:{click:W}}),Z=new Element("div",{id:"lbCaption"}),O=new Element("div",{id:"lbNumber"}),new Element("div",{styles:{clear:"both"}}));});function aa(){var b=U.getScroll(),a=U.getSize();$$(aA,S).setStyle("left",b.x+(a.x/2));if(ae){R.setStyles({left:b.x,top:b.y,width:a.x,height:a.y});}}function ao(b){["object",am?"select":"embed"].forEach(function(c){Array.forEach(document.getElementsByTagName(c),function(d){if(b){d._slimbox=d.style.visibility;}d.style.visibility=b?"hidden":d._slimbox;});});R.style.display=b?"":"none";var a=b?"addEvent":"removeEvent";U[a]("scroll",aa)[a]("resize",aa);document[a]("keydown",ak);}function ak(a){var b=a.code;return af.closeKeys.contains(b)?W():af.nextKeys.contains(b)?av():af.previousKeys.contains(b)?Y():false;}function Y(){return az(ad);}function av(){return az(V);}function az(a){if(a>=0){T=a;al=au[a][0];ad=(T||(af.loop?au.length:0))-1;V=((T+1)%au.length)||(af.loop?0:-1);ai();aA.className="lbLoading";an=new Image();an.onload=ap;an.src=al;}return false;}function ap(){aA.className="";ax.set(0);at.setStyles({backgroundImage:"url("+al+")",display:""});aj.setStyle("width",an.width);$$(aj,Q,aw).setStyle("height",an.height);Z.set("html",au[T][1]||"");O.set("html",(((au.length>1)&&af.counterText)||"").replace(/{x}/,T+1).replace(/{y}/,au.length));if(ad>=0){ag.src=au[ad][0];}if(V>=0){P.src=au[V][0];}N=at.offsetWidth;ah=at.offsetHeight;var a=Math.max(0,ab-(ah/2)),c=0,b;if(aA.offsetHeight!=ah){c=ar.start({height:ah,top:a});}if(aA.offsetWidth!=N){c=ar.start({width:N,marginLeft:-N/2});}b=function(){S.setStyles({width:N,top:a+ah,marginLeft:-N/2,visibility:"hidden",display:""});ax.start(1);};if(c){ar.chain(b);}else{b();}}function aq(){if(ad>=0){Q.style.display="";}if(V>=0){aw.style.display="";}X.set(-ay.offsetHeight).start(0);S.style.visibility="";}function ai(){an.onload=$empty;an.src=ag.src=P.src=al;ar.cancel();ax.cancel();X.cancel();$$(Q,aw,at,S).setStyle("display","none");}function W(){if(T>=0){ai();T=ad=V=-1;aA.style.display="none";ac.cancel().chain(ao).start(0);}return false;}Element.implement({slimbox:function(b,a){$$(this).slimbox(b,a);return this;}});Elements.implement({slimbox:function(d,a,b){a=a||function(e){return[e.href,e.title];};b=b||function(){return true;};var c=this;c.removeEvents("click").addEvent("click",function(){var e=c.filter(b,this);return Slimbox.open(e.map(a),e.indexOf(this),d);});return c;}});return{open:function(a,b,c){af=$extend({loop:false,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeTransition:false,initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},c||{});ac=new Fx.Tween(R,{property:"opacity",duration:af.overlayFadeDuration});ar=new Fx.Morph(aA,$extend({duration:af.resizeDuration,link:"chain"},af.resizeTransition?{transition:af.resizeTransition}:{}));ax=new Fx.Tween(at,{property:"opacity",duration:af.imageFadeDuration,onComplete:aq});X=new Fx.Tween(ay,{property:"margin-top",duration:af.captionAnimationDuration});if(typeof a=="string"){a=[[a,b]];b=0;}ab=U.getScrollTop()+(U.getHeight()/2);N=af.initialWidth;ah=af.initialHeight;aA.setStyles({top:Math.max(0,ab-(ah/2)),width:N,height:ah,marginLeft:-N/2,display:""});ae=am||(R.currentStyle&&(R.currentStyle.position!="fixed"));if(ae){R.style.position="absolute";}ac.set(0).start(af.overlayOpacity);aa();ao(1);au=a;af.loop=af.loop&&(au.length>1);return az(b);}};})();Slimbox.scanPage=function(){$$("a").filter(function(a){return a.rel&&a.rel.test(/^lightbox/i);}).slimbox({loop:true},null,function(a){return(this==a)||((this.rel.length>8)&&(this.rel==a.rel));});};if(!/android|iphone|ipod|series60|symbian|windows ce|blackberry/i.test(navigator.userAgent)){window.addEvent("domready",Slimbox.scanPage);}